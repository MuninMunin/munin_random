<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christmas Treasure Hunt</title>
    
    <!-- Original Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/MotionPathPlugin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <!-- NEW: Tailwind & Animate.css -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    
    <style>
        /* --- FONTS --- */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap');
        @font-face {
            font-family: 'mountains_of_christmasregular';
            src: url('https://s3-us-west-2.amazonaws.com/s.cdpn.io/35984/mountainsofchristmas-webfont.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }

        :root {
            --bg-green: #01443c;
            --xmas-red: #c0392b;
            --gold: #f1c40f;
            --glass: rgba(255, 255, 255, 0.12);
        }

        * { box-sizing: border-box; }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: #01443c;
            font-family: 'Inter', 'Segoe UI', sans-serif; 
        }

        /* --- INTRO ANIMATION SECTION --- */
        #intro-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 100;
            background: #01443c;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .mainSVG { width: 90%; height: 90%; visibility: hidden; }
        .particle { fill: white; }
        .endMessage {
            font-family: 'mountains_of_christmasregular', serif;
            font-size: 2rem;
            text-anchor: middle;
            text-align: center;
            fill: #ffffff;
            color: #ffffff;
            opacity: 0;
            letter-spacing: 1px;
        }

        /* --- IMAGE POP ANIMATION --- */
        #popImage {
            position: fixed;
            top: 50%; left: 50%;
            width: 300px; height: 300px;
            object-fit: contain;
            transform: translate(-50%, -50%) scale(0);
            z-index: 101;
            pointer-events: none;
        }

        /* --- GAME CONTENT SECTION --- */
        #game-content {
            position: relative;
            width: 100%; height: 100%;
            background-color: var(--bg-green);
            background-image: url('bg.png'); 
            background-size: auto 100vh; 
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 2s ease;
        }

        #game-content::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4); 
            z-index: 0;
        }

        #snowCanvas {
            position: fixed;
            top: 0; left: 0;
            pointer-events: none;
            z-index: 2;
        }

        .card-wrapper {
            position: relative;
            z-index: 5;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .initial-card {
            background: var(--glass);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 40px;
            padding: 3rem 1.5rem;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0,0,0,0.6);
            width: 90%;
            max-width: 400px;
            transform: translateY(20px);
            transition: transform 1.5s cubic-bezier(0.22, 1, 0.36, 1);
        }

        .initial-card.active { transform: translateY(0); }

        h1 {
            color: var(--gold);
            font-size: 2.2rem;
            margin: 0;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: -1px;
            text-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1rem;
            margin-top: 10px;
            opacity: 0.9;
            color: white;
        }

        .chest-container {
            height: 220px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            position: relative;
        }

        .gift-glow {
            position: absolute;
            width: 150px; height: 150px;
            background: radial-gradient(circle, rgba(241, 196, 15, 0.4) 0%, transparent 70%);
            border-radius: 50%;
            animation: pulse-glow 2s infinite alternate;
        }

        .chest {
            font-size: 110px;
            cursor: pointer;
            z-index: 6;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.4));
            user-select: none;
        }

        .chest:hover { transform: scale(1.15) rotate(5deg); }
        .chest.bounce { animation: gentle-wobble 2.5s infinite ease-in-out; }

        @keyframes gentle-wobble {
            0%, 100% { transform: translateY(0) rotate(0); }
            50% { transform: translateY(-15px) rotate(3deg); }
        }

        @keyframes pulse-glow {
            from { transform: scale(0.8); opacity: 0.5; }
            to { transform: scale(1.3); opacity: 1; }
        }

        /* --- REWARD STYLES --- */
        #rewardArea {
            display: none;
            position: relative;
            z-index: 50;
            width: 100%;
            justify-content: center;
            align-items: center;
        }

        .bg-gradient-radial { background-image: radial-gradient(circle, var(--tw-gradient-stops)); }
        .perspective-1000 { perspective: 1000px; }
        .text-glow { text-shadow: 0 0 20px rgba(239, 68, 68, 0.5); }
        .gold-text {
            background: linear-gradient(to right, #fef08a, #eab308, #fef08a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .modal-enter { animation: zoomIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes zoomIn {
            from { opacity: 0; transform: scale(0.8) translateY(40px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .book-card { transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .book-card:hover { transform: translateY(-15px) rotate(0deg) scale(1.05); z-index: 30; }
        @keyframes pulse-slow { 0%, 100% { opacity: 0.1; } 50% { opacity: 0.3; } }

        /* --- NEW: CELEBRATION STYLES --- */
        #celebration-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 200;
            overflow: hidden;
            pointer-events: none; /* Let clicks pass through if needed, or remove to block */
        }

        .memory-photo {
            position: absolute;
            width: 150px; /* Base size */
            height: auto;
            border: 4px solid white;
            border-bottom: 25px solid white; /* Polaroid style */
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            border-radius: 4px;
            object-fit: cover;
            will-change: transform;
        }
    </style>
</head>
<body>
    
    <!-- AUDIO PLAYER (Add your music.mp3 file in the same folder) -->
    <audio id="celebrationMusic" src="music.mp3"></audio>

    <!-- STAGE 3: CELEBRATION OVERLAY -->
    <div id="celebration-overlay"></div>

    <!-- STAGE 1: INTRO ANIMATION -->
    <div id="intro-overlay">
        <svg class="mainSVG" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600">
            <!-- (SVG Content preserved) -->
            <defs>
                <circle id="circ" class="particle" cx="0" cy="0" r="1" />
                <polygon id="star" class="particle" points="4.55,0 5.95,2.85 9.1,3.3 6.82,5.52 7.36,8.65 4.55,7.17 1.74,8.65 2.27,5.52 0,3.3 3.14,2.85 " />
                <polygon id="cross" class="particle" points="4,3.5 2.5,2 4,0.5 3.5,0 2,1.5 0.5,0 0,0.5 1.5,2 0,3.5 0.5,4 2,2.5 3.5,4 " />
                <path id="heart" class="particle" d="M2.9,0C2.53,0,2.2,0.18,2,0.47C1.8,0.18,1.47,0,1.1,0C0.49,0,0,0.49,0,1.1 C0,2.6,1.56,4,2,4s2-1.4,2-2.9C4,0.49,3.51,0,2.9,0z" />
                <radialGradient id="dotGrad" cx="0" cy="0" r="50" gradientUnits="userSpaceOnUse">
                    <stop offset="0" style="stop-color:#FFFFFF;stop-opacity:1" />
                    <stop offset="0.1" style="stop-color:#0867C7;stop-opacity:0.6" />
                    <stop offset="1" style="stop-color:#081029;stop-opacity:0" />
                </radialGradient>
                <mask id="treePathMask"><path class="treePathMask" fill="none" stroke-width="18" stroke="#FFF" d="M252.9,447.9c0,0-30.8-21.6,33.9-44.7c64.7-23.1,46.2-37,33.9-41.6 c-12.3-4.6-59.3-11.6-42.4-28.5s114-52.4,81.7-66.2c-32.4-13.9-58.5-10.8-35.4-29.3s66.2-101.7,70.9-115.6 c4.4-13.2,16.9-18.5,24.7,0c7.7,18.5,44.7,100.1,67.8,115.6c23.1,15.4-10.8,21.6-26.2,24.7c-15.4,3.1-20,33.9,33.9,49.3 c53.9,15.4,47.8,40.1,27.7,44.7c-20,4.6-63.2,4.6-27.7,32.4s98.6,21.6,61.6,60.1" /></mask>
                <mask id="treeBottomMask"><path class="treeBottomMask" stroke="#FFF" stroke-width="8" d="M207.5,484.1c0,0,58.5-43.1,211.1-3.1s191-16.9,191-16.9" /></mask>
                <mask id="treePotMask"><path class="treePotMask" stroke="#FFF" stroke-width="8" d="M374.3,502.5c0,0-4.6,20,7.7,29.3c12.3,9.2,40.1,7.7,50.8,0s10.8-23.1,10.8-29.3" /></mask>
            </defs>
            <g class="whole">
                <g class="pContainer"></g>
                <g class="tree" mask="url(#treePathMask)">
                    <path d="M252.95,447.85c-1.42-1.92-3.64-3.13-5.64-6.24a14,14,0,0,1-1.91-8.22,16.93,16.93,0,0,1,3.06-8,33.16,33.16,0,0,1,5.79-6.28A74.78,74.78,0,0,1,268.54,410a163.48,163.48,0,0,1,15.52-6.84c10.54-3.93,21-8.07,30.72-13.46a80.83,80.83,0,0,0,7-4.37,37.51,37.51,0,0,0,6.13-5.24c1.75-1.92,3.14-4.18,3.25-6.35s-1.12-4.18-3-5.81a25,25,0,0,0-6.72-3.91,61.25,61.25,0,0,0-7.8-2.42c-5.41-1.4-10.91-2.72-16.38-4.32a84.17,84.17,0,0,1-16.2-6.19,28.26,28.26,0,0,1-3.86-2.5,15.06,15.06,0,0,1-3.44-3.63,9,9,0,0,1-1.51-5.47,10.22,10.22,0,0,1,.61-2.78,12.88,12.88,0,0,1,1.2-2.34,26.73,26.73,0,0,1,6.58-6.56c2.35-1.76,4.76-3.33,7.19-4.84,4.87-3,9.82-5.75,14.77-8.46,9.91-5.4,19.88-10.59,29.63-16.08,4.87-2.75,9.68-5.56,14.33-8.56A81.88,81.88,0,0,0,359.45,280a23,23,0,0,0,2.41-2.79,8.36,8.36,0,0,0,1.35-2.65,2.13,2.13,0,0,0-.17-1.7,5.53,5.53,0,0,0-1.88-1.77,13.15,13.15,0,0,0-1.49-.83c-.52-.26-1.1-.49-1.76-.77-1.27-.53-2.55-1-3.83-1.53q-3.86-1.48-7.8-2.77c-5.26-1.74-10.6-3.23-16-4.79-2.72-.79-5.47-1.58-8.29-2.61a31.74,31.74,0,0,1-4.33-1.92,14.39,14.39,0,0,1-2.29-1.53,8.74,8.74,0,0,1-2.22-2.66,7.2,7.2,0,0,1-.78-4,9.09,9.09,0,0,1,1-3.24,18.93,18.93,0,0,1,3-4.21,44.88,44.88,0,0,1,3.29-3.19c.56-.5,1.12-1,1.68-1.45l1.61-1.33a84,84,0,0,0,10.88-11.88,326.2,326.2,0,0,0,18.79-27.53c5.88-9.5,11.48-19.19,16.89-29S380.1,146.16,385,136.13c1.22-2.51,2.42-5,3.57-7.54s2.29-5.09,3.14-7.45l.36-1c.14-.38.26-.75.42-1.12.29-.75.64-1.48,1-2.21a25.51,25.51,0,0,1,2.65-4.21,19.15,19.15,0,0,1,3.76-3.69,13.74,13.74,0,0,1,5.24-2.42,12.11,12.11,0,0,1,6.12.25,14.59,14.59,0,0,1,5,2.79,20.59,20.59,0,0,1,3.47,3.79,30.33,30.33,0,0,1,2.5,4.1c.35.7.7,1.39,1,2.1l.46,1.05.4,1,1.64,3.84,3.39,7.67q6.88,15.32,14.36,30.37c5,10,10.18,19.94,15.69,29.65a274.94,274.94,0,0,0,17.9,28A73.36,73.36,0,0,0,487.74,233c.49.4,1,.8,1.48,1.15l1.7,1.19a35,35,0,0,1,3.66,3,17.84,17.84,0,0,1,3.32,4.08,10.83,10.83,0,0,1,1.14,2.94,8.54,8.54,0,0,1,0,3.54,10.27,10.27,0,0,1-3.22,5.39,20.71,20.71,0,0,1-4.15,2.91,49,49,0,0,1-8.4,3.46,154,154,0,0,1-16.77,4.09l-4.15.81a9.18,9.18,0,0,0-2.87,1.08,9.51,9.51,0,0,0-4,4.7,12.55,12.55,0,0,0-.67,6.58,19.5,19.5,0,0,0,2.46,6.74A37.19,37.19,0,0,0,468,295.75a75,75,0,0,0,14.14,7.86,129.67,129.67,0,0,0,15.58,5.49A141.4,141.4,0,0,1,513.88,315a75,75,0,0,1,15.19,8.65,37.29,37.29,0,0,1,6.55,6.24,21.05,21.05,0,0,1,4.31,8.49,14.43,14.43,0,0,1-1.24,9.88,18.08,18.08,0,0,1-6.66,6.94,26.74,26.74,0,0,1-8.56,3.33c-2.84.61-5.65,1.06-8.44,1.49-5.58.86-11.13,1.61-16.52,2.77a53.48,53.48,0,0,0-7.81,2.22c-2.43.94-4.81,2.22-6,3.93a4.34,4.34,0,0,0-.77,2.82,8.45,8.45,0,0,0,1,3.29,28,28,0,0,0,4.82,6.25,80.74,80.74,0,0,0,12.81,10.4c9.29,6,19.72,10.29,30.24,14.17,5.27,1.95,10.59,3.79,15.85,5.86,2.63,1,5.24,2.14,7.79,3.39a37.94,37.94,0,0,1,7.28,4.51,11.9,11.9,0,0,1,3.63,15.57,34.68,34.68,0,0,1-4.53,7.16,77.45,77.45,0,0,1-5.64,6.29,77.31,77.31,0,0,0,5.41-6.46,34.27,34.27,0,0,0,4.22-7.21,12.64,12.64,0,0,0,.88-8,12.44,12.44,0,0,0-4.71-6.43,37.71,37.71,0,0,0-7.15-4.16c-2.53-1.16-5.13-2.18-7.76-3.14-5.26-1.91-10.62-3.62-16-5.44-10.65-3.63-21.34-7.64-31.11-13.64a83.84,83.84,0,0,1-13.61-10.49,31.27,31.27,0,0,1-5.6-6.94,12,12,0,0,1-1.55-4.68,8.17,8.17,0,0,1,.19-2.7,8.56,8.56,0,0,1,1.09-2.5,12.1,12.1,0,0,1,3.6-3.44,24.27,24.27,0,0,1,4.08-2.08,57.3,57.3,0,0,1,8.36-2.56c5.59-1.31,11.19-2.17,16.71-3.12,2.76-.48,5.5-1,8.15-1.59a22.1,22.1,0,0,0,7-2.87,13.3,13.3,0,0,0,4.82-5.15,9.42,9.42,0,0,0,.69-6.53,16,16,0,0,0-3.42-6.33,33.25,33.25,0,0,0-5.73-5.27,69.74,69.74,0,0,0-14.19-7.8,135.81,135.81,0,0,0-15.61-5.42,135.53,135.53,0,0,1-16.3-5.51,81,81,0,0,1-15.41-8.31,43.39,43.39,0,0,1-12.6-13,25.53,25.53,0,0,1-3.34-9,19.13,19.13,0,0,1,1-10,16.17,16.17,0,0,1,6.69-8,15.88,15.88,0,0,1,5-1.93l4.13-.84a147.75,147.75,0,0,0,16-4,42.41,42.41,0,0,0,7.17-3,14,14,0,0,0,2.74-1.92,3.42,3.42,0,0,0,1.12-1.68,2.41,2.41,0,0,0-.43-1.61,11.07,11.07,0,0,0-2-2.4,28,28,0,0,0-2.92-2.31l-1.76-1.22c-.65-.46-1.26-.94-1.86-1.43a59,59,0,0,1-6.43-6.27c-2-2.19-3.79-4.44-5.54-6.74a267,267,0,0,1-18.55-28.74c-5.63-9.85-10.89-19.86-16-30s-9.91-20.31-14.57-30.61l-3.45-7.76L417,124.48l-.42-1-.39-.88c-.25-.59-.54-1.15-.82-1.71a22.74,22.74,0,0,0-1.89-3.09,13,13,0,0,0-2.2-2.42,7,7,0,0,0-2.31-1.33,4.49,4.49,0,0,0-2.22-.09,8.55,8.55,0,0,0-4.59,3.32,17.85,17.85,0,0,0-1.84,2.92c-.26.54-.51,1.07-.73,1.64-.12.27-.22.56-.32.85l-.35,1c-1.06,2.93-2.23,5.47-3.42,8.1s-2.42,5.16-3.67,7.7c-5,10.18-10.29,20.16-15.77,30.05s-11.17,19.66-17.16,29.28a310.2,310.2,0,0,1-19.39,28.11,90.46,90.46,0,0,1-12,12.85l-1.65,1.35c-.52.43-1,.85-1.53,1.29a38,38,0,0,0-2.79,2.65,12.42,12.42,0,0,0-1.94,2.57,2.33,2.33,0,0,0-.28.76c0,.11,0,0,0,.09a4.57,4.57,0,0,0,1.7,1.35,25.15,25.15,0,0,0,3.36,1.51c2.46.92,5.11,1.72,7.79,2.52,5.36,1.58,10.84,3.16,16.25,5q4.06,1.37,8.08,2.94c1.34.53,2.67,1.07,4,1.63.64.27,1.36.57,2.1.94a19.66,19.66,0,0,1,2.18,1.24,11.85,11.85,0,0,1,4,4.13,8.64,8.64,0,0,1,1,3.24,9.11,9.11,0,0,1-.27,3.23,14.48,14.48,0,0,1-2.42,4.85,29.32,29.32,0,0,1-3.14,3.56,87.46,87.46,0,0,1-14,10.47c-4.85,3-9.79,5.84-14.76,8.55-9.94,5.42-20,10.49-29.91,15.72-5,2.62-9.88,5.28-14.63,8.12-2.37,1.42-4.7,2.89-6.88,4.46a22.06,22.06,0,0,0-5.45,5.14,8,8,0,0,0-.76,1.39,5.36,5.36,0,0,0-.33,1.32,4.1,4.1,0,0,0,.69,2.53,15.62,15.62,0,0,0,5.49,4.62A80.14,80.14,0,0,0,298.56,353c5.31,1.66,10.73,3.06,16.18,4.58a64.81,64.81,0,0,1,8.26,2.74,27.74,27.74,0,0,1,7.69,4.74,13.65,13.65,0,0,1,3,3.81,9.27,9.27,0,0,1,1,5,11.14,11.14,0,0,1-1.54,4.7,19.09,19.09,0,0,1-2.8,3.67,40.6,40.6,0,0,1-6.81,5.54,83.78,83.78,0,0,1-7.41,4.35c-10.11,5.26-20.76,9.16-31.39,12.82a161.69,161.69,0,0,0-15.52,6.37A74.57,74.57,0,0,0,255,420a32.17,32.17,0,0,0-5.82,5.89,16.21,16.21,0,0,0-3.19,7.52,13.61,13.61,0,0,0,1.59,8A20.29,20.29,0,0,0,252.95,447.85Z" fill="#cb9866" />
                    <path d="M207.5,484.06c7.05-5.11,15.14-8.66,23.34-11.63a177.13,177.13,0,0,1,25.29-6.88,263.65,263.65,0,0,1,52.22-4.49h3.28l3.28.09,6.56.19,6.55.39c2.18.13,4.37.26,6.54.48,4.35.39,8.71.74,13,1.28l6.51.75,6.49.91c17.3,2.5,34.41,6,51.36,10.19l12.62,3.2c4.18,1,8.34,2.18,12.55,3.06,8.38,2,16.82,3.63,25.29,5.13a353.5,353.5,0,0,0,51.17,5.47c17.11.32,34.36-.66,51-4.7a118.55,118.55,0,0,0,24.21-8.47,84.82,84.82,0,0,0,11.11-6.49,47.55,47.55,0,0,0,9.69-8.53,48.1,48.1,0,0,1-9,9.45,85.1,85.1,0,0,1-10.81,7.45,116.56,116.56,0,0,1-24.23,10.24,165.66,165.66,0,0,1-25.79,5.35,232.1,232.1,0,0,1-26.27,1.71c-8.77,0-17.55-.24-26.26-1.09-2.18-.2-4.37-.35-6.54-.6l-6.52-.78c-4.36-.46-8.67-1.19-13-1.82-8.64-1.37-17.22-3.09-25.74-5-4.28-.87-8.5-2-12.75-3l-12.62-3.11q-25.06-6.37-50.58-10.47a426.37,426.37,0,0,0-51.3-5.3c-8.59-.42-17.19-.29-25.78,0a240.1,240.1,0,0,0-25.68,2.24,186.57,186.57,0,0,0-25.27,5.19c-4.15,1.16-8.26,2.49-12.28,4.05-2,.79-4,1.6-6,2.52A50.82,50.82,0,0,0,207.5,484.06Z" fill="#cb9866" />
                    <path d="M374.32,502.55a48.15,48.15,0,0,0,1.24,14.35c1.15,4.52,3.29,8.64,6.49,11.35a18.5,18.5,0,0,0,5.51,3.14,39.06,39.06,0,0,0,6.41,1.82,65.78,65.78,0,0,0,13.68,1.12,72.9,72.9,0,0,0,13.72-1.44,44.51,44.51,0,0,0,6.46-1.85,17.75,17.75,0,0,0,5.51-3.15,25.45,25.45,0,0,0,7.24-11.17,52,52,0,0,0,1.9-6.91c.48-2.37.83-4.8,1.18-7.25a55.16,55.16,0,0,1,.64,7.42,40.11,40.11,0,0,1-.52,7.56,31.23,31.23,0,0,1-2.19,7.5,24.37,24.37,0,0,1-4.46,6.79,25.16,25.16,0,0,1-6.61,5,39.72,39.72,0,0,1-7.4,3A58.55,58.55,0,0,1,407.75,542a55,55,0,0,1-15.47-1.9,36.65,36.65,0,0,1-7.46-3,25.3,25.3,0,0,1-6.6-5,19.63,19.63,0,0,1-2.5-3.34,21.72,21.72,0,0,1-1.79-3.67,27.66,27.66,0,0,1-1.65-7.7,38.16,38.16,0,0,1,2-14.87Z" fill="#cb9866" />
                </g>
                <path class="treeBottomPath" stroke="none" fill="none" stroke-width="8" d="M207.5,484.1c0,0,58.5-43.1,211.1-3.1s191-16.9,191-16.9" />
                <path class="treePath" fill="none" stroke="none" stroke-miterlimit="10" d="M252.95,447.85s-30.81-21.57,33.89-44.68,46.22-37,33.89-41.6-59.32-11.56-42.37-28.5,114-52.38,81.66-66.25S301.48,256,324.59,237.55,390.84,135.87,395.46,122c4.41-13.24,16.95-18.49,24.65,0s44.68,100.14,67.79,115.55-10.78,21.57-26.19,24.65-20,33.89,33.89,49.3,47.76,40.06,27.73,44.68-63.17,4.62-27.73,32.35,98.6,21.57,61.63,60.09" />
                <path class="treeBottom" mask="url(#treeBottomMask)" d="M207.5,484.06c7.05-5.11,15.14-8.66,23.34-11.63a177.13,177.13,0,0,1,25.29-6.88,263.65,263.65,0,0,1,52.22-4.49h3.28l3.28.09,6.56.19,6.55.39c2.18.13,4.37.26,6.54.48,4.35.39,8.71.74,13,1.28l6.51.75,6.49.91c17.3,2.5,34.41,6,51.36,10.19l12.62,3.2c4.18,1,8.34,2.18,12.55,3.06,8.38,2,16.82,3.63,25.29,5.13a353.5,353.5,0,0,0,51.17,5.47c17.11.32,34.36-.66,51-4.7a118.55,118.55,0,0,0,24.21-8.47,84.82,84.82,0,0,0,11.11-6.49,47.55,47.55,0,0,0,9.69-8.53,48.1,48.1,0,0,1-9,9.45,85.1,85.1,0,0,1-10.81,7.45,116.56,116.56,0,0,1-24.23,10.24,165.66,165.66,0,0,1-25.79,5.35,232.1,232.1,0,0,1-26.27,1.71c-8.77,0-17.55-.24-26.26-1.09-2.18-.2-4.37-.35-6.54-.6l-6.52-.78c-4.36-.46-8.67-1.19-13-1.82-8.64-1.37-17.22-3.09-25.74-5-4.28-.87-8.5-2-12.75-3l-12.62-3.11q-25.06-6.37-50.58-10.47a426.37,426.37,0,0,0-51.3-5.3c-8.59-.42-17.19-.29-25.78,0a240.1,240.1,0,0,0-25.68,2.24,186.57,186.57,0,0,0-25.27,5.19c-4.15,1.16-8.26,2.49-12.28,4.05-2,.79-4,1.6-6,2.52A50.82,50.82,0,0,0,207.5,484.06Z" fill="#cb9866" />
                <path class="treePot" mask="url(#treePotMask)" d="M374.32,502.55a48.15,48.15,0,0,0,1.24,14.35c1.15,4.52,3.29,8.64,6.49,11.35a18.5,18.5,0,0,0,5.51,3.14,39.06,39.06,0,0,0,6.41,1.82,65.78,65.78,0,0,0,13.68,1.12,72.9,72.9,0,0,0,13.72-1.44,44.51,44.51,0,0,0,6.46-1.85,17.75,17.75,0,0,0,5.51-3.15,25.45,25.45,0,0,0,7.24-11.17,52,52,0,0,0,1.9-6.91c.48-2.37.83-4.8,1.18-7.25a55.16,55.16,0,0,1,.64,7.42,40.11,40.11,0,0,1-.52,7.56,31.23,31.23,0,0,1-2.19,7.5,24.37,24.37,0,0,1-4.46,6.79,25.16,25.16,0,0,1-6.61,5,39.72,39.72,0,0,1-7.4,3A58.55,58.55,0,0,1,407.75,542a55,55,0,0,1-15.47-1.9,36.65,36.65,0,0,1-7.46-3,25.3,25.3,0,0,1-6.6-5,19.63,19.63,0,0,1-2.5-3.34,21.72,21.72,0,0,1-1.79-3.67,27.66,27.66,0,0,1-1.65-7.7,38.16,38.16,0,0,1,2-14.87Z" fill="#cb9866" />
                <g class="treeStar">
                    <path class="treeStarOutline" opacity="0" d="M421,53.27c5,.83,10.08,1.52,15.15,2.13l3.8.45,1.9.21c.33,0,.6.06,1,.12a2.41,2.41,0,0,1,1.27.66,2.52,2.52,0,0,1,.56,2.76,3.42,3.42,0,0,1-.78,1.07l-.66.69-2.65,2.77c-1.78,1.83-3.54,3.68-5.35,5.48l-2.7,2.71L429.81,75l-.69.67-.34.33,0,0h0a.14.14,0,0,0,0-.08s0-.07,0,0l0,.24.07.47.57,3.78c.4,2.52.71,5,1.06,7.57l.94,7.59.22,1.9c0,.06,0,.19,0,.34a2.21,2.21,0,0,1,0,.43,2.72,2.72,0,0,1-.21.84,2.85,2.85,0,0,1-2.65,1.75,2.57,2.57,0,0,1-.82-.14,3.12,3.12,0,0,1-.65-.3l-1.64-1-6.58-3.91-6.63-3.81-3.34-1.86-.42-.23-.21-.12-.14-.07a1,1,0,0,0-.59,0,1.15,1.15,0,0,0-.31.12l-.43.22-.85.44c-2.27,1.17-4.54,2.31-6.79,3.52s-4.51,2.38-6.74,3.61l-3.36,1.83-.84.46a3.07,3.07,0,0,1-1.28.44,2.68,2.68,0,0,1-2.84-3l.15-1,.29-1.89.57-3.78,1.18-7.56,1.24-7.52a.13.13,0,0,0,0,.08l0,0-.1-.09-.17-.17-1.37-1.34-2.73-2.68-10.93-10.7-.34-.33a4,4,0,0,1-.64-.84,3.63,3.63,0,0,1-.43-2.12,3.68,3.68,0,0,1,2.64-3.17l.52-.11.25,0,.47-.06.95-.12,1.9-.25,7.58-1,7.6-.9,1.9-.23.95-.11c.24,0,.11,0,.09,0l-.09.05-.07.08,0,0,.09-.16.46-.84.91-1.68c2.41-4.5,4.95-8.92,7.51-13.34l1-1.66.48-.83.24-.41.13-.23a3.49,3.49,0,0,1,.22-.33,2.66,2.66,0,0,1,2.83-.9,2.52,2.52,0,0,1,1.26.84,2.85,2.85,0,0,1,.37.62l.18.44q1.45,3.54,3,7.06c1,2.36,2,4.68,3.06,7,.51,1.17,1.06,2.32,1.59,3.48l.8,1.74a2.12,2.12,0,0,0,.45.75A1.42,1.42,0,0,0,421,53.27Zm-.06.39a1.82,1.82,0,0,1-1-.46,2.52,2.52,0,0,1-.56-.86l-.84-1.72c-.56-1.14-1.11-2.3-1.69-3.43-1.17-2.27-2.29-4.56-3.5-6.81s-2.39-4.51-3.6-6.76l-.23-.42a.8.8,0,0,0-.14-.18.58.58,0,0,0-.33-.15.56.56,0,0,0-.57.28L407,36.48c-2.09,4.66-4.2,9.31-6.45,13.88l-.83,1.72-.42.86-.13.27a3.57,3.57,0,0,1-2,1.67,4.26,4.26,0,0,1-.84.18l-.95.13-1.89.27L386,56.53l-7.58,1-3.49.44a.45.45,0,0,0,.34-.4.51.51,0,0,0-.07-.28s-.06-.08-.07-.08l.33.34,10.65,11,2.66,2.75,1.33,1.37.4.42a3.41,3.41,0,0,1,.53.84,3.36,3.36,0,0,1,.24,1.95c-.53,2.56-1,5-1.57,7.52L388,90.85l-.83,3.73-.42,1.87-.2.9a.5.5,0,0,0,0,.3.58.58,0,0,0,.52.37,6.28,6.28,0,0,0,1.38-.58l3.46-1.62q3.47-1.61,6.9-3.3c2.3-1.1,4.57-2.26,6.85-3.39l.86-.43.43-.21a2.55,2.55,0,0,1,.57-.22,2.21,2.21,0,0,1,1.29.08l.29.13.21.11.42.23,3.37,1.81,6.8,3.51,6.85,3.41,1.71.85c.19.09.15.07.22.08a.25.25,0,0,0,.12,0,.42.42,0,0,0,.21-.1.33.33,0,0,0,.1-.19.2.2,0,0,0,0-.09.1.1,0,0,0,0,0l0-.13L428.74,96l-1.42-7.52c-.43-2.51-.9-5-1.29-7.54l-.6-3.78-.08-.47,0-.24a3.75,3.75,0,0,1,0-.45,3.37,3.37,0,0,1,.52-1.9,3.33,3.33,0,0,1,.3-.4,3.73,3.73,0,0,1,.3-.3l.35-.32.7-.65,2.81-2.59,2.86-2.54c1.9-1.71,3.84-3.36,5.77-5l2.91-2.49a12.91,12.91,0,0,0,1.15-1,.7.7,0,0,0-.06-.79.73.73,0,0,0-.37-.26c-.23-.06-.6-.13-.89-.2l-1.87-.4L436,56.39C431,55.39,426,54.45,420.95,53.66Z" fill="#FFFCF9" />
                    <path d="M408.12,83.45l-17.78,8.94,3.72-19.55-14-14.15,19.74-2.5,9.13-17.68,8.48,18L437,59.73l-14.5,13.63,3,19.67Z" fill="#C89568" />
                </g>
                <circle class="sparkle" fill="url(#dotGrad)" cx="0" cy="0" r="50" />
            </g>
            <foreignObject id="endMessage" x="0" y="550" width="800" height="250">
                <span class="endMessage">Merry Christmas! üéÑ</span>
            </foreignObject>
        </svg>
    </div>

    <!-- STAGE 1.5: POP IMAGE -->
    <img id="popImage" src="img.png" alt="Christmas">

    <!-- STAGE 2: TREASURE HUNT PAGE -->
    <div id="game-content">
        <canvas id="snowCanvas"></canvas>
        
        <div class="card-wrapper" id="mainCard">
            <!-- Initial State: Glass Card with Gift -->
            <div id="initialState" class="initial-card">
                <div id="introGroup">
                    <h1>Merry Christmas!</h1>
                    <p class="subtitle">Tap to unlock your special gift</p>
                </div>

                <div class="chest-container">
                    <div class="gift-glow"></div>
                    <div class="chest bounce" id="giftBox" onclick="openGift()">üéÅ</div>
                </div>
            </div>

            <!-- NEW REWARD STATE -->
            <div id="rewardArea">
                <div id="stars-container" class="absolute inset-0 overflow-hidden pointer-events-none" style="position: fixed;"></div>

                <div id="modal-card" class="relative bg-[#0a0a0c] border border-white/10 rounded-[2.5rem] shadow-[0_0_80px_rgba(255,255,255,0.05)] w-full max-w-lg overflow-hidden modal-enter mx-4">
                    <div class="absolute inset-0 border-[1px] border-yellow-500/20 rounded-[2.5rem] pointer-events-none"></div>

                    <div class="relative pt-16 pb-10 px-8 text-center">
                        <div class="absolute inset-0 pointer-events-none overflow-hidden">
                            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-gradient-radial from-red-600/20 to-transparent opacity-40 animate-pulse"></div>
                        </div>

                        <div class="relative flex items-end justify-center mb-10 mt-6 h-52 perspective-1000">
                            <!-- Book 1 (Left) -->
                            <div class="book-card absolute left-[15%] w-28 h-40 bg-gradient-to-br from-slate-800 to-black rounded-r-md shadow-2xl transform -rotate-[25deg] translate-y-6 border-l-[10px] border-slate-900 flex items-start p-4">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white/20"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
                            </div>
                            <!-- Book 3 (Right) -->
                            <div class="book-card absolute right-[15%] w-28 h-40 bg-gradient-to-br from-slate-800 to-black rounded-r-md shadow-2xl transform rotate-[25deg] translate-y-6 border-l-[10px] border-slate-900 flex items-start justify-end p-4">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white/20"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
                            </div>
                            <!-- Book 2 (Center) -->
                            <div class="book-card relative w-32 h-48 bg-gradient-to-br from-red-700 to-red-950 rounded-r-lg shadow-[0_20px_50px_rgba(0,0,0,0.6)] z-10 transform -translate-y-4 border-l-[12px] border-red-950 overflow-hidden">
                                <div class="absolute inset-0 bg-white/5 opacity-10 pointer-events-none"></div>
                                <div class="absolute inset-0 flex flex-col items-center justify-center p-4">
                                <div class="w-16 h-[2px] bg-yellow-400/40 mb-4"></div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-400 drop-shadow-[0_0_15px_rgba(250,204,21,0.6)]"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
                                <div class="w-16 h-[2px] bg-yellow-400/40 mt-4"></div>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4 mb-10 relative z-10">
                            <div class="inline-flex items-center space-x-2 px-4 py-1.5 bg-red-600/10 border border-red-500/30 text-red-400 text-[10px] font-black rounded-full uppercase tracking-[0.2em]">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="animate-spin-slow"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3z"/></svg>
                                <span>Gift Unlocked</span>
                            </div>
                            
                            <h2 class="text-4xl font-black text-white tracking-tight leading-none uppercase italic">
                                Novel <br/> 
                                <span class="gold-text">Books</span>
                            </h2>

                            <p class="text-slate-400 max-w-xs mx-auto text-sm font-medium leading-relaxed">
                                Heyy, I know you are into reading lately, so I got you this voucher to claim some novels from your favorite book store. Claim this gift from your santa ^^
                            </p>
                        </div>

                        <div class="px-4">
                            <!-- BUTTON CHANGED: Calls celebrate() instead of reload -->
                            <button onclick="celebrate()" class="w-full bg-gradient-to-r from-red-600 to-red-800 hover:from-red-500 hover:to-red-700 text-white font-black py-5 rounded-2xl shadow-[0_10px_30px_rgba(220,38,38,0.3)] transition-all flex items-center justify-center space-x-3 group relative overflow-hidden uppercase tracking-widest text-sm">
                                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000"></div>
                                <span>Yayyyyyyyy</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="group-hover:translate-x-1 transition-transform"><path d="m9 18 6-6-6-6"/></svg>
                            </button>
                        </div>
                        
                        <p class="mt-6 text-[10px] text-slate-500 font-bold uppercase tracking-[0.3em] flex items-center justify-center space-x-2">
                            <span class="w-8 h-[1px] bg-slate-800"></span>
                            <span>Merry Christmas ah biebie ^^ </span>
                            <span class="w-8 h-[1px] bg-slate-800"></span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        gsap.registerPlugin(MotionPathPlugin);

        // --- CHRISTMAS TREE LOADING ANIMATION (UNCHANGED) ---
        (function () {
            function r(a) { gsap.killTweensOf(a, { opacity: true }); gsap.fromTo(a, { opacity: 1 }, { duration: 0.07, opacity: Math.random(), repeat: -1 }); }
            function t(a) { if (e) { a = l[d]; gsap.set(a, { x: gsap.getProperty(".pContainer", "x"), y: gsap.getProperty(".pContainer", "y"), scale: m() }); gsap.timeline().to(a, { duration: gsap.utils.random(0.61, 6), physics2D: { velocity: gsap.utils.random(-23, 23), angle: gsap.utils.random(-180, 180), gravity: gsap.utils.random(-6, 50) }, scale: 0, rotation: gsap.utils.random(-123, 360), ease: "power1", onStart: r, onStartParams: [a], onRepeat: function (b) { gsap.set(b, { scale: m() }); }, onRepeatParams: [a] }); d++; d = 201 <= d ? 0 : d; } }
            const u = document.querySelector(".mainSVG"), c = document.querySelector(".sparkle"); let e = true, l = [], d = 0, m = gsap.utils.random(0.5, 3, 0.001, true); const n = "#E8F6F8 #ACE8F8 #F6FBFE #A2CBDC #B74551 #5DBA72 #910B28 #910B28 #446D39".split(" "), p = ["#star", "#circ", "#cross", "#heart"];
            gsap.set("svg", { visibility: "visible" }); gsap.set(c, { transformOrigin: "50% 50%", y: -100 });
            (function () { for (let a = 201, b; --a >= 0; ) { b = document.querySelector(p[a % p.length]).cloneNode(true); u.appendChild(b); b.setAttribute("fill", n[a % n.length]); b.setAttribute("class", "particle"); l.push(b); gsap.set(b, { x: -100, y: -100, transformOrigin: "50% 50%" }); } })();
            function runAnimation() { const timeline = gsap.timeline({ onComplete: transitionToGame, onUpdate: t }); timeline.to(".pContainer, .sparkle", { duration: 6, motionPath: { path: ".treePath", autoRotate: false }, ease: "linear" }).to(".pContainer, .sparkle", { duration: 1, onStart: function () { e = false; }, x: 0, y: 0 }).to(".pContainer, .sparkle", { duration: 2, onStart: function () { e = true; }, motionPath: { path: ".treeBottomPath", autoRotate: false }, ease: "linear" }, "-=0").from(".treeBottomMask", { duration: 2, drawSVG: "0% 0%", stroke: "#FFF", ease: "linear" }, "-=2"); const mainTimeline = gsap.timeline(); mainTimeline.from([".treePathMask", ".treePotMask"], { drawSVG: "0% 0%", stroke: "#FFF", stagger: { each: 6 }, duration: 6, ease: "linear" }).from(".treeStar", { duration: 3, scaleY: 0, scaleX: 0.15, transformOrigin: "50% 50%", ease: "elastic(1,0.5)" }, "-=4").to(".sparkle", { duration: 3, opacity: 0, ease: "power1.inOut" }, "-=0").to(".treeStarOutline", { duration: 1, opacity: 1, ease: "power1.inOut" }, "+=1"); mainTimeline.add(timeline, 0); gsap.globalTimeline.timeScale(1.5); }
            window.addEventListener('load', runAnimation);
        })();

        function transitionToGame() {
            const intro = document.getElementById('intro-overlay');
            const game = document.getElementById('game-content');
            const card = document.querySelector('.initial-card');
            const popImage = document.getElementById('popImage');
            intro.style.opacity = '0';
            setTimeout(() => {
                intro.style.display = 'none';
                const imageTL = gsap.timeline({ onComplete: () => { popImage.style.display = 'none'; game.style.visibility = 'visible'; game.style.opacity = '1'; setTimeout(() => { card.classList.add('active'); initSnow(); }, 100); } });
                imageTL.to(popImage, { duration: 0.4, scale: 1.2, ease: "back.out(1.7)" }).to(popImage, { duration: 5, rotation: 720, ease: "linear" }).to(popImage, { duration: 0.6, scale: 0, opacity: 0, ease: "power2.in" }, "-=0");
            }, 1200);
        }

        // --- SNOWFALL ENGINE ---
        let width, height, flakes = [];
        const canvas = document.getElementById('snowCanvas'), ctx = canvas.getContext('2d');
        function initSnow() { width = window.innerWidth; height = window.innerHeight; canvas.width = width; canvas.height = height; flakes = Array.from({length: 120}, () => ({ x: Math.random() * width, y: Math.random() * height, r: Math.random() * 3 + 1, d: Math.random() * 1 + 0.5, o: Math.random() * 0.5 + 0.3 })); requestAnimationFrame(drawSnow); }
        function drawSnow() { ctx.clearRect(0, 0, width, height); flakes.forEach(f => { ctx.fillStyle = `rgba(255, 255, 255, ${f.o})`; ctx.beginPath(); ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2); ctx.fill(); f.y += f.d; if (f.y > height) f.y = -10; }); requestAnimationFrame(drawSnow); }
        window.addEventListener('resize', () => { if(canvas.offsetParent !== null) { width = window.innerWidth; height = window.innerHeight; canvas.width = width; canvas.height = height; } });

        // --- GAME INTERACTION & STARS ---
        function createStars() {
            const starsContainer = document.getElementById('stars-container');
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('div');
                star.className = 'absolute bg-white rounded-full opacity-20';
                star.style.width = Math.random() * 3 + 'px'; star.style.height = star.style.width;
                star.style.top = Math.random() * 100 + '%'; star.style.left = Math.random() * 100 + '%';
                star.style.animation = `pulse-slow ${3 + Math.random() * 4}s infinite`;
                starsContainer.appendChild(star);
            }
        }

        function openGift() {
            const gift = document.getElementById('giftBox');
            const initialState = document.getElementById('initialState');
            const reward = document.getElementById('rewardArea');
            const glow = document.querySelector('.gift-glow');

            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#f1c40f', '#c0392b', '#ffffff', '#2ecc71'] });
            gift.classList.remove('bounce'); gift.style.transform = "scale(0) rotate(720deg)"; gift.style.opacity = "0"; glow.style.transform = "scale(3)"; glow.style.opacity = "0";
            
            setTimeout(() => { initialState.style.display = 'none'; reward.style.display = 'flex'; createStars(); }, 600);
        }

        // --- CELEBRATION LOGIC (UPDATED) ---
        const memoryImages = [
            'images/photo1.png', 'images/photo2.png', 'images/photo3.png', 'images/photo4.png',
            'images/photo5.png', 'images/photo6.png', 'images/photo7.png', 'images/photo8.png',
            'images/photo9.png', 'images/photo10.png', 'images/photo12.png',
            'images/photo13.png', 'images/photo14.png', 'images/photo15.png', 'images/photo16.png',
            'images/photo17.png', 'images/photo18.png', 'images/photo19.png', 'images/photo20.png',
            'images/photo21.png', 'images/photo22.png', 'images/photo23.png', 'images/photo24.png',
            'images/photo25.png', 'images/photo26.png', 'images/photo27.png', 'images/photo28.png',
            'images/photo29.png', 'images/photo30.png', 'images/photo31.png'
        ];

        function celebrate() {
            // 1. Hide the reward card
            const rewardCard = document.getElementById('modal-card');
            gsap.to(rewardCard, {
                opacity: 0,
                scale: 0.8,
                duration: 0.5,
                onComplete: () => { rewardCard.style.display = 'none'; }
            });

            // 2. Play Music
            const audio = document.getElementById('celebrationMusic');
            audio.play().catch(e => console.log("Audio autoplay might require user interaction setting"));

            // 3. Setup Overlay
            const overlay = document.getElementById('celebration-overlay');
            overlay.style.display = 'block';

            // 4. RANDOM SELECTION (3-5 Images)
            const totalImages = memoryImages.length;
            const countToFade = Math.floor(Math.random() * 3) + 15; // Picks 3, 4, or 5
            const indicesToFade = new Set();
            while (indicesToFade.size < countToFade) {
                indicesToFade.add(Math.floor(Math.random() * totalImages));
            }

            // 5. Generate Flying Images
            memoryImages.forEach((src, index) => {
                const img = document.createElement('img');
                img.src = src;
                img.classList.add('memory-photo');
                overlay.appendChild(img);

                // --- Positioning ---
                // Random Horizontal, Staggered Vertical
                const startX = Math.random() * (window.innerWidth - 200);
                const startY = window.innerHeight + 200 + (Math.random() * 300);
                
                const shouldFade = indicesToFade.has(index);
                const scale = Math.random() * 0.4 + 0.6; // 0.6 to 1.0

                gsap.set(img, {
                    x: startX,
                    y: startY,
                    scale: scale,
                    rotation: Math.random() * 30 - 15,
                    opacity: 0
                });

                // Entrance Fade In
                gsap.to(img, { opacity: 1, duration: 1, delay: index * 0.2 });

                // --- FLOAT ANIMATION ---
                function floatUp(target) {
                    const duration = 15 + Math.random() * 15; // Speed
                    
                    // We need a slight delay on the very first run to sync with the entrance
                    // But on repeats (loop), we don't want delays or it looks jerky
                    const tl = gsap.timeline({
                        repeat: -1,
                        defaults: { ease: "none" }
                    });

                    // 1. Move Up
                    // fromTo is crucial here to ensure opacity resets to 1 on every loop
                    tl.fromTo(target, 
                        { y: window.innerHeight + 300, opacity: 1 }, 
                        { y: -400, duration: duration }
                    );

                    // 2. Conditional Fade Out
                    if (shouldFade) {
                        // "Quickly fade out after crossing 1/3 of screen"
                        // Insert a fade at 60% of the timeline (approx where top 1/3 starts)
                        tl.to(target, {
                            opacity: 0,
                            duration: 1.5, // Fast fade (1.5s)
                            ease: "power2.in"
                        }, "<" + (duration * 0.6)); 
                    }

                    // --- Independent Motion (Swaying) ---
                    gsap.to(target, {
                        x: "+=" + (Math.random() * 200 - 100),
                        duration: 4 + Math.random() * 4,
                        yoyo: true,
                        repeat: -1,
                        ease: "sine.inOut"
                    });

                    gsap.to(target, {
                        scale: scale * 1.1,
                        rotation: "+=" + (Math.random() * 20 - 10),
                        duration: 3 + Math.random() * 2,
                        yoyo: true,
                        repeat: -1,
                        ease: "sine.inOut"
                    });
                }

                floatUp(img);
            });
        }
    </script>
</body>
</html>